<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Login | XNEON Technologies</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
        (function() {
            // 2Ô∏è‚É£ YOUR PUBLIC KEY
            emailjs.init("7ps995woJ-0Gp79Nm");
        })();
    </script>

    <style>body { background-color: #000; color: #ccc; }</style>
</head>
<body class="p-4">

    <div id="auth-layer" class="fixed inset-0 bg-black z-[100] flex items-center justify-center p-4">
        <div class="bg-[#111] p-8 rounded-2xl border border-gray-800 w-full max-w-sm text-center shadow-2xl">
            <img src="https://via.placeholder.com/150x50?text=XNEON" class="h-12 mx-auto mb-6 opacity-80">
            
            <h2 class="text-2xl font-bold text-white mb-2">Admin Verification</h2>
            <p class="text-gray-500 text-sm mb-6">Enter your registered email to receive OTP.</p>

            <div id="step-email">
                <input type="email" id="admin-email-input" class="w-full bg-black border border-gray-700 text-white p-3 rounded-lg mb-4 text-center focus:border-red-600 outline-none transition" placeholder="Enter Admin Email">
                <button onclick="sendOTP()" id="send-btn" class="w-full bg-white text-black font-bold py-3 rounded-lg hover:bg-gray-200 transition">SEND OTP</button>
            </div>

            <div id="step-otp" class="hidden">
                <input type="number" id="otp-input" class="w-full bg-black border border-gray-700 text-white p-3 rounded-lg mb-4 text-center tracking-[10px] text-xl font-bold focus:border-green-500 outline-none transition" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                <button onclick="verifyOTP()" class="w-full bg-green-600 text-white font-bold py-3 rounded-lg hover:bg-green-700 transition">VERIFY & LOGIN</button>
                <button onclick="location.reload()" class="mt-4 text-xs text-gray-500 underline">Resend / Change Email</button>
            </div>
            
            <p id="status-msg" class="mt-4 text-xs text-yellow-500 animate-pulse hidden">Sending OTP...</p>
        </div>
    </div>

    <div id="dashboard" class="max-w-4xl mx-auto hidden">
        <div class="flex justify-between items-center mb-8 border-b border-gray-800 pb-4">
            <h1 class="text-3xl text-white font-bold">Admin Panel</h1>
            <div class="flex gap-4">
                <button onclick="logout()" class="text-red-500 font-bold text-sm">LOGOUT</button>
                <button onclick="window.location.href='index.html'" class="text-blue-500 text-sm">VIEW SITE</button>
            </div>
        </div>

        <div class="flex gap-2 mb-6 overflow-x-auto pb-2">
            <button onclick="showTab('orders')" class="px-4 py-2 bg-gray-800 rounded text-white hover:bg-gray-700 whitespace-nowrap">üì¶ Orders</button>
            <button onclick="showTab('products')" class="px-4 py-2 bg-gray-800 rounded text-white hover:bg-gray-700 whitespace-nowrap">üöÅ Products</button>
            <button onclick="showTab('categories')" class="px-4 py-2 bg-gray-800 rounded text-white hover:bg-gray-700 whitespace-nowrap">üìÇ Categories</button>
            <button onclick="showTab('slider')" class="px-4 py-2 bg-gray-800 rounded text-white hover:bg-gray-700 whitespace-nowrap">üñºÔ∏è Slider</button>
            <button onclick="showTab('settings')" class="px-4 py-2 bg-gray-800 rounded text-white hover:bg-gray-700 whitespace-nowrap">‚öôÔ∏è Settings</button>
        </div>

        <div id="tab-orders" class="block"><h2 class="text-2xl font-bold text-white mb-4">Manage Orders</h2><div id="admin-orders-list" class="space-y-4">Loading...</div></div>
        
        <div id="tab-products" class="hidden">
            <div class="mb-8 bg-[#111] p-4 rounded border border-gray-800">
                <h3 class="text-white font-bold mb-4">Add New Product</h3>
                <input id="p-name" class="w-full bg-black border border-gray-700 p-2 mb-2 rounded" placeholder="Product Name">
                <input id="p-price" type="number" class="w-full bg-black border border-gray-700 p-2 mb-2 rounded" placeholder="Price (‚Çπ)">
                <select id="p-category" class="w-full bg-black border border-gray-700 p-2 mb-2 rounded text-white"><option value="General">General</option></select>
                <textarea id="p-desc" class="w-full bg-black border border-gray-700 p-2 mb-2 rounded" placeholder="Description"></textarea>
                <textarea id="p-specs" class="w-full bg-black border border-gray-700 p-2 mb-2 rounded" placeholder="Specifications"></textarea>
                <div class="mb-2 p-2 border border-gray-800 rounded">
                    <label class="text-xs text-gray-500 mb-2 block">Images (URLs)</label>
                    <div id="image-inputs-container" class="space-y-2"><input class="w-full bg-black border border-gray-700 p-2 rounded p-img-input" placeholder="Main Image URL"></div>
                    <button onclick="addImgInput()" class="text-xs text-blue-500 mt-2 font-bold">+ Add Image URL</button>
                </div>
                <button onclick="saveProduct()" class="w-full bg-green-600 text-white font-bold p-3 rounded mt-2">SAVE PRODUCT</button>
            </div>
            <h3 class="text-white font-bold mb-2">Existing Products</h3><div id="product-list" class="space-y-2">Loading...</div>
        </div>

        <div id="tab-categories" class="hidden">
            <div class="mb-8 bg-[#111] p-4 rounded border border-gray-800"><h3 class="text-white font-bold mb-4">Add Category</h3><input id="c-name" class="w-full bg-black border border-gray-700 p-2 mb-2 rounded" placeholder="Name"><input id="c-image" class="w-full bg-black border border-gray-700 p-2 mb-2 rounded" placeholder="Image URL"><button onclick="saveCategory()" class="w-full bg-purple-600 text-white font-bold p-3 rounded mt-2">SAVE</button></div>
            <div id="category-list" class="grid grid-cols-2 gap-4">Loading...</div>
        </div>

        <div id="tab-slider" class="hidden">
            <div class="mb-8 bg-[#111] p-4 rounded border border-gray-800"><h3 class="text-white font-bold mb-4">Add Slide</h3><input id="s-image" class="w-full bg-black border border-gray-700 p-2 mb-2 rounded" placeholder="Image URL"><input id="s-link" class="w-full bg-black border border-gray-700 p-2 mb-2 rounded" placeholder="Link"><input id="s-title" class="w-full bg-black border border-gray-700 p-2 mb-2 rounded" placeholder="Title"><button onclick="addSlide()" class="w-full bg-blue-600 text-white font-bold p-3 rounded">ADD</button></div>
            <div id="slider-list" class="grid grid-cols-1 gap-4"></div>
        </div>

        <div id="tab-settings" class="hidden">
            <div class="bg-[#111] p-4 rounded border border-gray-800"><h3 class="text-white font-bold mb-4">Logo</h3><input id="logo-url" class="w-full bg-black border border-gray-700 p-2 mb-2 rounded" placeholder="URL"><button onclick="updateLogo()" class="bg-white text-black font-bold px-4 py-2 rounded">Update</button></div>
        </div>
    </div>

    <div id="ship-modal" class="fixed inset-0 bg-black/90 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-[#111] p-6 rounded-xl border border-gray-800 w-full max-w-sm">
            <h3 class="text-xl font-bold text-white mb-4">Ship Order</h3>
            <input id="ship-partner" class="w-full bg-black border border-gray-700 p-2 mb-3 rounded text-white" placeholder="Partner">
            <input id="ship-track" class="w-full bg-black border border-gray-700 p-2 mb-4 rounded text-white" placeholder="Tracking ID">
            <button id="confirm-ship-btn" class="w-full bg-blue-600 text-white font-bold py-2 rounded">CONFIRM</button>
            <button onclick="document.getElementById('ship-modal').classList.add('hidden')" class="w-full mt-2 text-gray-500 py-2">Cancel</button>
        </div>
    </div>

    <script type="module">
        import { db, doc, updateDoc, addDoc, deleteDoc, setDoc, collection, query, orderBy, onSnapshot, formatINR } from './firebase-config.js';

        // =========================================================
        // üî¥ SECURITY SETTING - APNA ASLI EMAIL YAHAN LIKHO
        // =========================================================
        const AUTHORIZED_EMAIL = "tumhara_asli_email@gmail.com"; 
        // =========================================================

        let generatedOTP = null;

        window.sendOTP = function() {
            let emailInput = document.getElementById('admin-email-input').value;
            const status = document.getElementById('status-msg');
            const btn = document.getElementById('send-btn');

            // Input safai
            emailInput = emailInput.trim().toLowerCase();
            const validEmail = AUTHORIZED_EMAIL.trim().toLowerCase();

            if(emailInput === "") {
                alert("Please enter an email address.");
                return;
            }

            // OTP Generate karo
            generatedOTP = Math.floor(100000 + Math.random() * 900000);
            
            // UI Update
            status.innerText = "Sending Verification...";
            status.classList.remove('hidden');
            btn.disabled = true;
            btn.innerText = "Processing...";

            // üöÄ MAGIC: Hamesha ADMIN ko email bhejo
            // Chahe chor ho ya admin, email sirf ADMIN (validEmail) ko jayega.
            const templateParams = {
                to_email: validEmail,        // ‚ö†Ô∏è Hamesha Tumhare Email par jayega
                otp_code: generatedOTP,      // OTP Code
                intruder_email: emailInput   // Wo email jo box mein dala gaya
            };

            emailjs.send("service_3vbmeu4", "template_0lecpgb", templateParams)
                .then(function(response) {
                    console.log("Email sent successfully!", response.status, response.text);

                    // Ab check karo ki banda asli hai ya nakli
                    if(emailInput === validEmail) {
                        // ‚úÖ ASLI ADMIN
                        status.innerText = "‚úÖ OTP Sent! Check your inbox.";
                        status.classList.remove('text-yellow-500');
                        status.classList.add('text-green-500');
                        
                        document.getElementById('step-email').classList.add('hidden');
                        document.getElementById('step-otp').classList.remove('hidden');
                    } else {
                        // ‚ùå NAKLI BANDA (HACKER)
                        // Email tumhe mil chuka hai background mein.
                        // Ab hacker ko error dikhao.
                        alert("‚ùå Access Denied: This email is not authorized. The Administrator has been notified of this attempt.");
                        location.reload();
                    }
                }, function(error) {
                    alert("‚ö†Ô∏è Network Error: Email could not be sent.");
                    console.log("EmailJS Error:", error);
                    btn.disabled = false;
                    btn.innerText = "SEND OTP";
                });
        };

        window.verifyOTP = function() {
            const enteredOTP = document.getElementById('otp-input').value;
            if(parseInt(enteredOTP) === generatedOTP) {
                document.getElementById('auth-layer').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                generatedOTP = null; 
            } else {
                alert("‚ùå Wrong OTP! Try again.");
            }
        };

        // ... Baaki functions same rahenge ...
        window.logout = function() { location.reload(); };
        window.showTab = (tabName) => { ['orders', 'products', 'categories', 'slider', 'settings'].forEach(t => { document.getElementById('tab-'+t).style.display = (t === tabName) ? 'block' : 'none'; }); };
        // ... (Baaki loadOrders wagera purana code same hai) ...
        loadOrders(); loadProducts(); loadCategories(); loadSlides();
        
        function loadOrders() { const q = query(collection(db, "orders"), orderBy("timestamp", "desc")); onSnapshot(q, (snap) => { const list = document.getElementById('admin-orders-list'); list.innerHTML = ""; if(snap.empty) { list.innerHTML = "<p>No orders.</p>"; return; } snap.forEach(d => { const o = d.data(); list.innerHTML += `<div class="bg-[#151515] p-4 rounded border border-gray-800 mb-4"><div class="flex justify-between mb-2"><span class="font-bold text-white">#${d.id.slice(0,6)}</span><span class="text-${o.status === 'Cancelled' ? 'red' : 'green'}-500 font-bold text-sm">${o.status}</span></div><div class="bg-black/50 p-3 rounded mb-3 border border-gray-800"><p class="text-xs text-gray-400 uppercase font-bold mb-1">Shipping Address:</p><p class="text-sm text-gray-200 leading-relaxed whitespace-pre-wrap">${o.address || "No address provided"}</p></div><p class="text-sm text-gray-400">Total: ${formatINR(o.total)} | Type: ${o.paymentMethod}</p><div class="flex gap-2 mt-3 flex-wrap"><button onclick="updateStatus('${d.id}', 'Confirmed')" class="px-3 py-1 bg-green-900 text-green-200 text-xs rounded">Confirm</button><button onclick="openShipModal('${d.id}')" class="px-3 py-1 bg-blue-900 text-blue-200 text-xs rounded">Shipped</button><button onclick="updateStatus('${d.id}', 'Delivered')" class="px-3 py-1 bg-gray-700 text-white text-xs rounded">Delivered</button><button onclick="cancelOrder('${d.id}')" class="px-3 py-1 bg-red-900 text-red-200 text-xs rounded">Cancel</button></div></div>`; }); }); }
        window.updateStatus = async (id, status) => { await updateDoc(doc(db, "orders", id), { status: status }); };
        let currentOrderId = null;
        window.openShipModal = (id) => { currentOrderId = id; document.getElementById('ship-modal').classList.remove('hidden'); };
        document.getElementById('confirm-ship-btn').addEventListener('click', async () => { const partner = document.getElementById('ship-partner').value; const track = document.getElementById('ship-track').value; if(currentOrderId && partner && track) { await updateDoc(doc(db, "orders", currentOrderId), { status: "Shipped", deliveryPartner: partner, trackingId: track }); document.getElementById('ship-modal').classList.add('hidden'); } });
        window.cancelOrder = async (id) => { if(confirm("Cancel?")) await updateDoc(doc(db, "orders", id), { status: "Cancelled" }); };
        window.updateLogo = async () => { const url = document.getElementById('logo-url').value; if(url) await setDoc(doc(db, "settings", "general"), { logo: url }, { merge: true }); alert("Updated!"); };
        window.saveCategory = async () => { const name = document.getElementById('c-name').value; const image = document.getElementById('c-image').value; if(name && image) await addDoc(collection(db, "categories"), { name, image }); alert("Added!"); };
        function loadCategories() { onSnapshot(collection(db, "categories"), (snap) => { const l = document.getElementById('category-list'); const d = document.getElementById('p-category'); l.innerHTML=""; d.innerHTML=`<option value="General">General</option>`; snap.forEach(doc => { const c=doc.data(); l.innerHTML+=`<div class="relative group bg-[#151515] p-2 rounded border border-gray-800"><img src="${c.image}" class="w-full h-24 object-cover rounded mb-2"><h4 class="text-white font-bold text-center">${c.name}</h4><button onclick="deleteCategory('${doc.id}')" class="absolute top-1 right-1 bg-red-600 text-white text-xs px-2 py-1 rounded">X</button></div>`; d.innerHTML+=`<option value="${c.name}">${c.name}</option>`; }); }); }
        window.deleteCategory = async (id) => { if(confirm("Delete?")) await deleteDoc(doc(db, "categories", id)); };
        window.addImgInput = () => { document.getElementById('image-inputs-container').innerHTML += `<input class="w-full bg-black border border-gray-700 p-2 rounded p-img-input mt-2" placeholder="Next Image URL">`; };
        window.saveProduct = async () => { const inputs = document.querySelectorAll('.p-img-input'); const imgArray = []; inputs.forEach(inp => { if(inp.value.trim() !== "") imgArray.push(inp.value.trim()); }); if(imgArray.length === 0) return alert("Add image"); await addDoc(collection(db, "products"), { name: document.getElementById('p-name').value, price: Number(document.getElementById('p-price').value), category: document.getElementById('p-category').value, desc: document.getElementById('p-desc').value, specs: document.getElementById('p-specs').value, images: imgArray, image: imgArray[0], createdAt: new Date() }); alert("Saved!"); location.reload(); };
        function loadProducts() { onSnapshot(collection(db, "products"), (snap) => { const l = document.getElementById('product-list'); l.innerHTML=""; snap.forEach(d => { l.innerHTML += `<div class="flex justify-between bg-[#151515] p-2 rounded border border-gray-800"><span>${d.data().name}</span><button onclick="deleteProduct('${d.id}')" class="text-red-500 text-sm">Delete</button></div>`; }); }); }
        window.deleteProduct = async(id) => { if(confirm("Delete?")) await deleteDoc(doc(db, "products", id)); };
        function loadSlides() { onSnapshot(collection(db, "slider"), (snap) => { const l = document.getElementById('slider-list'); l.innerHTML=""; snap.forEach(d => { const s = d.data(); l.innerHTML += `<div class="relative group"><img src="${s.image}" class="w-full h-32 object-cover rounded border border-gray-700"><button onclick="deleteSlide('${d.id}')" class="absolute top-1 right-1 bg-red-600 text-white text-xs px-2 py-1 rounded">Del</button></div>`; }); }); }
        window.addSlide = async () => { await addDoc(collection(db, "slider"), { image: document.getElementById('s-image').value, link: document.getElementById('s-link').value, title: document.getElementById('s-title').value }); alert("Added"); };
        window.deleteSlide = async (id) => { if(confirm("Delete?")) await deleteDoc(doc(db, "slider", id)); };
    </script>
</body>
</html>